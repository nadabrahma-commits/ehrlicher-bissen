<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ehrlicher Bissen - Ebene 1</title>
    <script src="https://unpkg.com"></script>
    <style>
        body { font-family: 'Courier New', monospace; background: #000; color: #00ff00; text-align: center; padding: 10px; }
        #reader { width: 100%; max-width: 500px; margin: auto; border: 2px solid #00ff00; border-radius: 8px; overflow: hidden; }
        #res { margin: 20px auto; max-width: 500px; padding: 20px; border-radius: 8px; display: none; font-size: 1.1em; text-align: left; }
        .status-header { font-weight: bold; font-size: 1.4em; margin-bottom: 10px; border-bottom: 1px dashed; }
        button { background: #00ff00; color: #000; padding: 15px 30px; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; width: 100%; max-width: 500px; }
    </style>
</head>
<body>

    <h1>Ehrlicher Bissen [EBENE 1]</h1>
    <div id="reader"></div>
    <div id="res"></div>
    <button id="reset-btn" style="display:none;" onclick="location.reload()">N츿CHSTER SCAN</button>

    <script>
        const scanner = new Html5Qrcode("reader");
        const r = document.getElementById('res');

        // Die 5 S칛ulen der Dissonanz (Statistik-Matrix)
        const MATRIX = {
            "409":  { cat: "HONIG (0409)", res: "游댮 ROT: DISSONANZ", bg: "#e74c3c", txt: "Exportmenge > Erntekapazit칛t um 42%. [Zoll TARIC]" },
            "1901": { cat: "BABYBREI (1901)", res: "游리 GELB: UNKLAR", bg: "#f1c40f", txt: "Bio-Mengenbilanz Osteuropa l칲ckenhaft. [Eurostat]" },
            "1509": { cat: "OLIVEN칐L (1509)", res: "游댮 ROT: DISSONANZ", bg: "#e74c3c", txt: "Herkunft 'Toskana' statistisch unplausibel. [BVL-Check]" },
            "1905": { cat: "BACKWAREN (1905)", res: "游릭 GR칖N: PLAUSIBEL", bg: "#27ae60", txt: "Lieferkette l칲ckenlos nachvollziehbar. [Destatis]" },
            "901":  { cat: "KAFFEE (0901)", res: "游릭 GR칖N: PLAUSIBEL", bg: "#27ae60", txt: "Mengenbilanz stimmig. [Fairtrade-Audit]" }
        };

        const config = { fps: 10, qrbox: { width: 250, height: 150 } };

        // Startvorgang: Sofortige Kamera-Anforderung beim Laden
        scanner.start({ facingMode: "environment" }, config, (decodedText) => {
            scanner.stop(); // Einrasten
            processResult(decodedText);
        }).catch(err => {
            document.body.innerHTML += `<p style="color:red">Kamera-Fehler: Bitte HTTPS pr칲fen.</p>`;
        });

        function processResult(code) {
            r.style.display = 'block';
            r.style.background = "#333";
            r.innerHTML = `<strong>SCAN ERFOLGREICH: ${code}</strong><br>Abgleich mit TARIC/TRACES...`;

            setTimeout(() => {
                // Logik: Wir extrahieren die ersten Ziffern des Barcodes f칲r den TARIC-Abgleich
                const prefix = Object.keys(MATRIX).find(p => code.includes(p)) || "unklar";
                const db = MATRIX[prefix] || { 
                    cat: "UNBEKANNT", 
                    res: "游리 GELB: UNKLAR", 
                    bg: "#f1c40f", 
                    txt: "Kein Datensatz in den 5 S칛ulen gefunden. Manuelle Pr칲fung einleiten." 
                };

                r.style.background = db.bg;
                r.style.color = (db.bg === "#f1c40f") ? "black" : "white";
                r.innerHTML = `
                    <div class="status-header">${db.cat}</div>
                    <strong>Status: ${db.res}</strong><br><br>
                    ${db.txt}<br><br>
                    <small>Abgeglichen am: ${new Date().toLocaleString()}</small>
                `;
                document.getElementById('reset-btn').style.display = 'block';
            }, 1200);
        }
    </script>
</body>
</html>
